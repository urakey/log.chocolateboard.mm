<!doctype html><html><head><meta charset=utf-8><title>WordPress から Middleman に移行しました :: log.chocolateboard</title><meta name=description content="年末に移行作業に手をつけて放置していたものを、やっと終わらせました。 移行したいと思ったきっかけは $ middleman deploy で公開！みたいなことがしたかったから。"><meta name=viewport content="width=device-width"><link rel=author href="/about/"><link rel=icon href=/favicon.ico><link rel=apple-touch-icon href=/assets/images/icon/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/assets/images/icon/apple-touch-icon-precomposed.png><link rel=license href="http://creativecommons.org/licenses/by-nc/4.0/"><link rel=alternate type=application/rss+xml title=RSS2.0 href=/feed.rss><link rel=canonical href="http://log.chocolateboard.net/middleman-blog-2015/"><meta property=og:title content="WordPress から Middleman に移行しました :: log.chocolateboard"><meta property=og:description content="年末に移行作業に手をつけて放置していたものを、やっと終わらせました。 移行したいと思ったきっかけは $ middleman deploy で公開！みたいなことがしたかったから。"><meta property=og:url content="http://log.chocolateboard.net/middleman-blog-2015/"><meta property=og:image content=http://log.chocolateboard.net/assets/images/posts/2015/03/middleman-blog-2015/eyecatch.png><meta property=og:type content=article><meta property=og:site_name content=log.chocolateboard><meta property=fb:app_id content=264941413542272 prefix="fb: http://ogp.me/ns/fb#"><meta name=twitter:card content=summary><meta name=twitter:site content=@chocolateboard><meta name=twitter:creator content=@urakey><meta name=twitter:image content=http://log.chocolateboard.net/assets/images/posts/2015/03/middleman-blog-2015/eyecatch.png><link href="//fonts.googleapis.com/css?family=Alegreya:400,400italic,700,700italic" rel=stylesheet><link href=/assets/styles/style.css rel=stylesheet></head><body role=document><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RZX8R" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RZX8R');</script><header class=header role=banner><h1 class=header__id><a href="/">log.chocolateboard</a></h1><nav class=header__navigation role=navigation><ul><li><a href=/categories/coding rel="tag category">coding</a></li><li><a href=/categories/design rel="tag category">design</a></li><li><a href=/categories/misc rel="tag category">misc</a></li><li><a href="/about/">about</a></li></ul></nav></header><div class=contents><main class=main role=main><article class=article itemprop=blogPost itemscope itemtype=http://schema.org/BlogPosting><h1 class=article__title itemprop=name>WordPress から Middleman に移行しました</h1><footer class=article__footer itemprop=articleBody><ul><li class=article__footerTime><span>Posted on</span><time datetime=2015-03-14T00:00:00&#43;09:00 itemprop=datePublished>March 14, 2015</time></li><li class=article__footerCategories><span>Categories</span> <a href="/categories/coding/" rel="tag category">Coding</a></li><li class=article__footerTags><span>Tags</span> <a href="/tags/middleman/" rel=tag>Middleman</a><a href="/tags/slim/" rel=tag>Slim</a><a href="/tags/github/" rel=tag>GitHub</a></li></ul></footer><figure class=article__eyecatch><img src=/assets/images/posts/2015/03/middleman-blog-2015/eyecatch.png alt itemprop=image></figure><div class=article__body itemprop=articleBody><p>年末に移行作業に手をつけて放置していたものを、やっと終わらせました。 移行したいと思ったきっかけは <code>$ middleman deploy</code> で公開！みたいなことがしたかったから。 なんかかっこいいし ^^ （動機不純）</p><p class=notice><em>Slim</em> というテンプレートエンジンの予習がしたかったという真面目な理由もあります。</p><p>途中、別件に心奪われて放置してましたが、やりかけ気持ち悪いので先週末に集中して終わらせました。 ついでにデザインをマイナーアップデートした！あんま変わってないけど。。。</p><p>何をしたかをざっとメモとして残します。</p><hr><h2 id=index>Index</h2><ul><li><a href=#p1>移行手順メモ</a></li><li><a href=#p2>インストールしたプラグイン</a></li><li><a href=#p3>テンプレートエンジン</a></li><li><a href=#p4>GitHub Pages でホスティング</a></li><li><a href=#p5>積み残しタスク</a></li></ul><hr><section id=p1><h2 id=移行手順メモ>移行手順メモ</h2><ol><li>Middleman をインストールして、ブログ機能に必要な環境をググって整えた</li><li>WordPress のテーマに使っていた Sass とか JS とか画像とかを Middleman 環境にコピー</li><li>Grunt でビルドしていたものを、Middleman 環境でビルドするように変更</li><li>Slim テンプレートエンジンでテーマをコーディング</li><li>WordPress に投稿済みの画像を Middleman 環境にコピー</li><li>WordPress に投稿済みの記事を Middleman 環境にコピー（Markdown で下書きしていたものがあるので、それをほぼそのまま移行できた）</li><li>GitHub Pages でホスティングする準備とテスト</li><li>イメチェン（デザインのマイナーアップデート）</li><li>かゆいところをなおす作業（無知ゆえ一番辛かった工程）</li><li>完成！！やったー</li></ol></section><section id=p2><h2 id=middleman-にインストールしたプラグイン>Middleman にインストールしたプラグイン</h2><pre><code class=language-ruby># If you have OpenSSL installed, we recommend updating
# the following line to use &quot;https&quot;
source 'http://rubygems.org'

gem 'middleman'
gem 'middleman-blog'
gem 'middleman-livereload'
gem 'middleman-rouge'
gem 'middleman-deploy'
gem 'middleman-blog-similar'
gem 'middleman-minify-html'
gem 'middleman-imageoptim'
gem 'slim'
gem 'nokogiri'
gem 'redcarpet'

# For feed.xml.builder
gem 'builder', '~&gt; 3.0'
</code></pre><h3 id=middleman-blog>middleman-blog</h3><p>Middlemanにブログ機能を追加するプラグインです。</p><ul><li><a href=https://github.com/middleman/middleman-blog>middleman/middleman-blog</a></li><li><a href="https://middlemanapp.com/jp/basics/blogging/">Middleman: ブログ機能</a></li></ul><p>WordPress の時と URL が変わらないよう、最初は思い通りの URL を作ることから始めました。 <code>$ middleman server</code> で内蔵のサーバが動くので、実際に動かして設定していくとわかりやすかった。</p><h4 id=config-rb>config.rb</h4><pre><code class=language-ruby>activate :blog do |blog|
  blog.layout = 'layouts/layout'
  blog.tag_template = 'tag.html'
  blog.calendar_template = 'calendar.html'

  blog.sources    = 'entries/{year}/{month}/{title}.html'
  blog.permalink  = '{title}/index.html'
  blog.taglink    = 'tag/{tag}/index.html'
  blog.year_link  = '{year}/index.html'
  blog.month_link = '{year}/{month}/index.html'
  blog.day_link   = '{year}/{month}/{day}/index.html'

  # Enable pagination
  blog.paginate = true
  blog.per_page = 10
  blog.page_link = 'page/{num}'

  blog.custom_collections = {
    categories: {
      link: '/{category}/index.html',
      template: '/category.html'
    }
  }
end

# Feed 生成
page &quot;/feed.xml&quot;, layout: false

# Sitemap 生成
page &quot;/sitemap.xml&quot;, layout: false

# ディレクトリインデックス
activate :directory_indexes
</code></pre><p>WordPress の時に持っていた「カテゴリー」という概念は引き継ぐことにしました。 <code>blog.custom_collections</code> のところで設定しています。</p><h3 id=middleman-livereload>middleman-livereload</h3><p>Middleman server を立ち上げてソースファイルに変更を加えるとブラウザが自動でリロードされます。</p><ul><li><a href=https://github.com/middleman/middleman-livereload>middleman/middleman-livereload</a></li></ul><h3 id=middleman-deploy>middleman-deploy</h3><p>デプロイ作業を簡略化できる。</p><ul><li><a href=https://github.com/middleman-contrib/middleman-deploy>middleman-contrib/middleman-deploy)</a></li></ul><h3 id=middleman-rouge>middleman-rouge</h3><p>シンタックスハイライト。</p><ul><li><a href=https://github.com/Linuus/middleman-rouge>Linuus/middleman-rouge</a></li></ul><h3 id=middleman-blog-similar>middleman-blog-similar</h3><p>類似記事を表示するプラグイン。設定周りはまだ試してません。とりあえずいれているだけ。</p><ul><li><a href=https://github.com/ngs/middleman-blog-similar>ngs/middleman-blog-similar</a></li></ul><h3 id=middleman-minify-html>middleman-minify-html</h3><p>HTML を Minify するプラグイン。</p><ul><li><a href=https://github.com/middleman/middleman-minify-html>middleman/middleman-minify-html</a></li><li><a href="https://middlemanapp.com/jp/advanced/file_size_optimization/">ファイルサイズ最適化</a></li></ul><h3 id=middleman-imageoptim>middleman-imageoptim</h3><p>画像圧縮。 <code>/build</code> 配下に最適化された画像が生成されます。</p><ul><li><a href=https://github.com/plasticine/middleman-imageoptim>plasticine/middleman-imageoptim</a></li><li><a href="https://middlemanapp.com/jp/advanced/file_size_optimization/">ファイルサイズ最適化</a></li></ul></section><section id=p3><h2 id=テンプレートエンジン>テンプレートエンジン</h2><h3 id=html-のテンプレートエンジン>HTML のテンプレートエンジン</h3><p>HTML 生成用のテンプレートエンジンは Slim を採用しました。<code>&lt;% %&gt;</code> とか書かなくて良くてすっきり ;D</p><ul><li><a href="https://middlemanapp.com/jp/basics/template_engine_options/">テンプレートエンジンオプション</a></li></ul><pre><code class=language-ruby># Slim
set :slim, :format =&gt; :html5, :sort_attrs =&gt; false, :pretty =&gt; true
</code></pre><h3 id=markdown-のテンプレートエンジン>Markdown のテンプレートエンジン</h3><p>投稿記事は Markdown で書くことにしました。</p><p>Markdown エンジンは、デフォルトの <em>Kramdown</em> から <em>Redcarpet</em> に変更しました。</p><p><em>Redcarpet</em> に変更して困ったことが、Markdown の中に書いた生の HTML がブロック要素の場合、HTML タグで囲われた Markdown 部分は Markdown として認識されません。 <em>Kramdown</em> なら Markdown として認識してくれるのに。。</p><p>いろいろ調べてみたら、ブロック要素で囲われた Markdown 部分が Markdown として認識されないのは仕様として正しいみたい。（無知でした）</p><p>寝かせて考えた結果、生の HTML を書きたいケースは限定されているので、カスタムレンダラを追加して対応しました。</p><h3 id=参考にさせていただいた記事-thx-xd>参考にさせていただいた記事 thx XD</h3><ul><li><a href=http://k0kubun.hatenablog.com/entry/2013/09/19/223400>Railsでカスタムmarkdownを実装する</a></li><li><a href=http://jumble-note.blogspot.jp/2014/06/rubymiddleman.html>ruby Middleman カスタムなレンダラ</a></li></ul></section><section id=p4><h2 id=github-pages-でホスティング>GitHub Pages でホスティング</h2><p>ユーザーに紐づくサイトと、プロジェクトに対するサイトのパターンがあるらしい。。。 前者は <code>username/username.github.io</code> というルールに則ってリポジトリを作る必要があるみたい。</p><p>今回は後者にしてみました！（なんとなく）</p><p>プロジェクトに対するサイトにした場合は、 <code>gh-pages</code> ブランチのコンテンツが使われるとのことなので、<code>$ middleman-deploy</code> したら、<code>gh-pages</code> ブランチに <code>push</code> されるようにしました。</p><pre><code class=language-ruby>activate :deploy do |deploy|
  deploy.method = :git
  deploy.branch = 'gh-pages'
end
</code></pre><p><code>log.chocolateboard.net</code> と書いた <em>CNAME</em> ファイルが <code>gh-pages</code> に含まれるようにして準備完了。 DNS の設定をいじってしばらく待ったら反映されました ^^</p><h3 id=参考にさせていただいた記事-thx-xd>参考にさせていただいた記事 thx XD</h3><ul><li><a href="https://help.github.com/articles/setting-up-a-custom-domain-with-github-pages/">Setting up a custom domain with GitHub Pages</a></li><li><a href="https://help.github.com/articles/tips-for-configuring-a-cname-record-with-your-dns-provider/">Tips for configuring a CNAME record with your DNS provider</a></li><li><a href="http://blog.coiney.com/2013/06/21/host-middleman-blog-on-github/">middleman-blogをgithubでホストする</a></li></ul></section><section id=p5><h2 id=積み残しタスク>積み残しタスク</h2><ul><li>検索窓つけようかな</li><li>サイドバーが長すぎるのでタグのデザイン変えよう</li><li>Feed の URL 変わってしまったのどうにかできないか調査する</li></ul></section><hr><p>夢の <code>deploy</code> できるようになりました XD</p><hr></div></article></main><div class=sidebar><aside><form class=searchbox action=http://www.google.co.jp/cse id=cse-search-box target=_blank><div class=searchbox__text><input type=hidden name=cx value=partner-pub-5462710571601739:3744752482> <input type=hidden name=ie value=UTF-8> <input type=text name=q size=55></div><div class=searchbox__submit><input type=submit name=sa value=検索></div></form><script src=//www.google.com/jsapi></script><script>
      google.load("elements", "1", {packages: "transliteration"});
    </script><script src="//www.google.com/cse/t13n?form=cse-search-box&amp;t13n_langs=en"></script><script src="'//www.google.co.jp/coop/cse/brand?form=cse-search-box&amp;lang=ja"></script></aside><aside><h2 class=sidebar__title>Pinterest</h2><div class=pinterest><a href="http://www.pinterest.com/urakey/" data-pin-do=embedUser>Visit akey's profile on Pinterest.</a><script src=//assets.pinterest.com/js/pinit.js async defer></script></div></aside><aside><h2 class=sidebar__title>Ads</h2><div class=ad--300><script src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js async defer></script><ins class=adsbygoogle data-ad-client=ca-pub-5462710571601739 data-ad-slot=6545665286 data-ad-format=auto></ins><script>
      (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside><nav><h2 class=sidebar__title>Tags</h2><ul class=sidebar__list--tags><li><a href=/tags/bash rel=tag>bash</a></li><li><a href=/tags/booklog rel=tag>booklog</a></li><li><a href=/tags/coffeescript rel=tag>coffeescript</a></li><li><a href=/tags/compass rel=tag>compass</a></li><li><a href=/tags/diary rel=tag>diary</a></li><li><a href=/tags/ect rel=tag>ect</a></li><li><a href=/tags/flickr rel=tag>flickr</a></li><li><a href=/tags/git rel=tag>git</a></li><li><a href=/tags/github rel=tag>github</a></li><li><a href=/tags/grep rel=tag>grep</a></li><li><a href=/tags/grunt rel=tag>grunt</a></li><li><a href=/tags/homebrew rel=tag>homebrew</a></li><li><a href=/tags/instagram rel=tag>instagram</a></li><li><a href=/tags/iterm rel=tag>iterm</a></li><li><a href=/tags/javascript rel=tag>javascript</a></li><li><a href=/tags/jquery rel=tag>jquery</a></li><li><a href=/tags/markdown rel=tag>markdown</a></li><li><a href=/tags/middleman rel=tag>middleman</a></li><li><a href=/tags/oh-my-zsh rel=tag>oh-my-zsh</a></li><li><a href=/tags/plugins rel=tag>plugins</a></li><li><a href=/tags/rss rel=tag>rss</a></li><li><a href=/tags/sass rel=tag>sass</a></li><li><a href=/tags/sketch rel=tag>sketch</a></li><li><a href=/tags/slim rel=tag>slim</a></li><li><a href=/tags/st2 rel=tag>st2</a></li><li><a href=/tags/st3 rel=tag>st3</a></li><li><a href=/tags/sublimetext rel=tag>sublimetext</a></li><li><a href=/tags/template rel=tag>template</a></li><li><a href=/tags/themes rel=tag>themes</a></li><li><a href=/tags/xcode rel=tag>xcode</a></li><li><a href=/tags/zsh rel=tag>zsh</a></li></ul></nav><nav><h2 class=sidebar__title>Categories</h2><ul class=sidebar__list--categories><li><a href=/categories/coding rel="tag category">coding</a></li><li><a href=/categories/design rel="tag category">design</a></li><li><a href=/categories/misc rel="tag category">misc</a></li></ul></nav><nav><h2 class=sidebar__title>Archives</h2><ul class=sidebar__list--archives><li><a href="/2011/">2011</a></li><li><a href="/2012/">2012</a></li><li><a href="/2013/">2013</a></li><li><a href="/2014/">2014</a></li><li><a href="/2015/">2015</a></li><li><a href="/2016/">2016</a></li></ul></nav><aside><h2 class=sidebar__title>Recommend</h2><div class=sidebar__recommend><figure><img src=http://ecx.images-amazon.com/images/I/512wo9i9iSL.jpg alt width=100><figcaption><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4774144665/chocolateboard-22/" target=_blank>JavaScript本格入門 ～モダンスタイルによる基礎からAjax・jQueryまで</a></figcaption></figure><p>とってもわかりやすいし、大事なことが書いてあるのでオススメです :D</p></div><div class=sidebar__recommend><figure><img src=http://ecx.images-amazon.com/images/I/41HX4p9BPSL.jpg alt width=100><figcaption><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B003N1XSIE/chocolateboard-22/" target=_blank>DELFONICS ロルバーン ポケット付きメモ（L）【レッド】 NRP03 RE</a></figcaption></figure><p>何度も何度も買っている愛用品 XD 毎回何色にしよっかなーと悩む</p></div></aside><aside><h2 class=sidebar__title>Hatena</h2><ul id=HatenaEntries class=sidebar__list></ul></aside><aside><h2 class=sidebar__title>Ads</h2><div class=ad--125><ul><li><a href="http://px.a8.net/svt/ejp?a8mat=25VU94+9NP6U2+D8Y+BXYE9" target=_blank onclick="ga( 'send', 'event', 'sideAD', 'Click', 'A8-sakuraVPS-125' );"><img src="http://www25.a8.net/svt/bgt?aid=130815976584&wid=002&eno=01&mid=s00000001717002006000&mc=1" alt border=0 width=125 height=125> <img src="http://www14.a8.net/0.gif?a8mat=25VU94+9NP6U2+D8Y+BXYE9" alt class=assistive border=0 width=1 height=1></a></li><li><a href="http://px.a8.net/svt/ejp?a8mat=1NS9OY+7IAU6Y+348+1C4941" target=_blank onclick="ga( 'send', 'event', 'sideAD', 'Click', 'A8-mumuDomain-125' );"><img src="http://www21.a8.net/svt/bgt?aid=100416274454&wid=002&eno=01&mid=s00000000404008082000&mc=1" alt border=0 width=125 height=125> <img src="http://www17.a8.net/0.gif?a8mat=1NS9OY+7IAU6Y+348+1C4941" alt class=assistive border=0 width=1 height=1></a></li><li><a href="http://px.a8.net/svt/ejp?a8mat=1TK0RQ+4KBOII+348+IGV6P" target=_blank onclick="ga( 'send', 'event', 'sideAD', 'Click', 'A8-colorMe-125' );"><img src="http://www21.a8.net/svt/bgt?aid=110109158276&wid=002&eno=01&mid=s00000000404003102000&mc=1" alt border=0 width=125 height=125> <img src="http://www14.a8.net/0.gif?a8mat=1TK0RQ+4KBOII+348+IGV6P" alt class=assistive border=0 width=1 height=1></a></li><li><a href="http://px.a8.net/svt/ejp?a8mat=25YAWC+3ZHICA+74E+6BU5T" target=_blank onclick="ga( 'send', 'event', 'sideAD', 'Click', 'A8-RakutenBank-125' );"><img src="http://www21.a8.net/svt/bgt?aid=130930860241&wid=002&eno=01&mid=s00000000923001063000&mc=1" alt border=0 width=125 height=125> <img src="http://www14.a8.net/0.gif?a8mat=25YAWC+3ZHICA+74E+6BU5T" alt class=assistive border=0 width=1 height=1></a></li></ul></div></aside></div></div><footer class=footer role=contentinfo><h2 class=assistive>About this site.</h2><address class=footer__byline itemprop=author itemscope itemtype=http://schema.org/Person><p>Designed &amp; developed by <a href=/about/#profile itemprop=url><span itemprop=name>akey</span></a>.</p></address><p class=footer__license><small>Except where otherwise noted,<br>content on this site is licensed under a Creative Commons<a href="http://creativecommons.org/licenses/by-nc/4.0/">Attribution-Noncommercial 4.0 License</a>.</small></p><div class=footer__social><h3 class=assistive>Elsewhere</h3><ul><li class=footer__social_feed><a href=/feed.rss>Subscribe to RSS Feed</a></li><li class=footer__social_twitter><a href=https://twitter.com/urakey>Twitter</a></li><li class=footer__social_facebook><a href=https://www.facebook.com/urakey>Facebook</a></li><li class=footer__social_pinterest><a href=http://pinterest.com/urakey>Pinterest</a></li><li class=footer__social_github><a href=https://github.com/urakey>GitHub</a></li></ul></div><div class=footer__links><h3 class=assistive>Copyright &amp; Links</h3><p><small>&copy; 2011-2016 chocolateboard.<wbr>Building this site with <a href="https://gohugo.io/">Hugo</a> and hosting it on <a href="https://pages.github.com/">GitHub Pages</a></small></p></div></footer><script src=/assets/scripts/vendor/jquery.min.js></script><script src=/assets/scripts/vendor/jquery.lazyload.min.js></script><script src=/assets/scripts/bundle.js></script></body></html>